arrange(date) %>%
select(date, tmax, tmin) %>%
cbind(xts(.$tmax, .$date),
xts(.$tmin, .$date))
SXtemp %>%
filter(city == "datong",
county == "datong",
date >= as.Date("2017-11-01"),
date <= as.Date("2017-11-28")) %>%
arrange(date) %>%
select(date, tmax, tmin) %>%
xts(., order.by = .$date) %>%
dygraph()
SXtemp %>%
filter(city == "datong",
county == "datong",
date >= as.Date("2017-11-01"),
date <= as.Date("2017-11-28")) %>%
arrange(date) %>%
select(date, tmax, tmin) %>%
xts(., order.by = .$date)
SXtemp %>%
filter(city == "datong",
county == "datong",
date >= as.Date("2017-11-01"),
date <= as.Date("2017-11-28")) %>%
arrange(date) %>%
select(date, tmax, tmin) %>%
xts(., order.by = .$date) %>%
select(tmax, tmin)
SXtemp %>%
filter(city == "datong",
county == "datong",
date >= as.Date("2017-01-01"),
date <= as.Date("2017-11-28")) %>%
arrange(date) %>%
select(date, tmax, tmin) %>%
xts(., order.by = .$date) %>%
dygraph()
SXtemp %>%
filter(city == "datong",
county == "datong",
date >= as.Date("2017-01-01"),
date <= as.Date("2017-11-28")) %>%
arrange(date) %>%
select(date, tmax, tmin) %>%
xts(., order.by = .$date) %>%
dygraph()%>% dyRangeSelector()
SXtemp %>%
filter(city == "datong",
county == "datong",
date >= as.Date("2017-01-01"),
date <= as.Date("2017-11-28")) %>%
arrange(date) %>%
select(date, tmax, tmin) %>%
xts(., order.by = .$date) %>%
dygraph() %>%
dySeries("tmax", label = "Maximum Temperature") %>%
dySeries("tmin", label = "Minimum Temperature") %>%
dyRangeSelector()
SXtemp %>%
filter(city == "datong",
county == "datong",
date >= as.Date("2017-01-01"),
date <= as.Date("2017-11-28")) %>%
arrange(date) %>%
select(date, tmax, tmin) %>%
xts(., order.by = .$date) %>%
dygraph() %>%
dySeries("tmax", label = "Maximum Temperature") %>%
dySeries("tmin", label = "Minimum Temperature") %>%
dyOptions(stackedGraph = TRUE) %>%
dyRangeSelector()
SXtemp %>%
filter(city == "datong",
county == "datong",
date >= as.Date("2017-01-01"),
date <= as.Date("2017-11-28")) %>%
arrange(date) %>%
select(date, tmax, tmin) %>%
xts(., order.by = .$date) %>%
dygraph(.) %>%
dySeries("tmax", label = "Maximum Temperature") %>%
dySeries("tmin", label = "Minimum Temperature") %>%
dyOptions(stackedGraph = TRUE) %>%
dyRangeSelector()
zz %>%
select(tmax, tmin) %>%
xts(., order.by = zz$date) %>%
dygraph(.) %>%
dySeries("tmax", label = "Maximum Temperature") %>%
dySeries("tmin", label = "Minimum Temperature") %>%
dyRangeSelector()
zz =  SXtemp %>%
filter(city == "datong",
county == "datong",
date >= as.Date("2017-01-01"),
date <= as.Date("2017-11-28")) %>%
arrange(date)
zz %>%
select(tmax, tmin) %>%
xts(., order.by = zz$date) %>%
dygraph(.) %>%
dySeries("tmax", label = "Maximum Temperature") %>%
dySeries("tmin", label = "Minimum Temperature") %>%
dyRangeSelector()
zz %>%
select(tmax, tmin) %>%
xts(., order.by = zz$date) %>%
dygraph(.) %>%
dySeries("tmax", label = "Maximum Temperature", color = "red") %>%
dySeries("tmin", label = "Minimum Temperature", color = "blue") %>%
dyRangeSelector()
zz %>%
select(tmax, tmin) %>%
xts(., order.by = zz$date) %>%
dygraph(.) %>%
dySeries("tmax", label = "Maximum", color = "red") %>%
dySeries("tmin", label = "Minimum", color = "blue") %>%
dyRangeSelector()
zz %>%
select(tmax, tmin) %>%
xts(., order.by = zz$date) %>%
dygraph(.) %>%
dySeries("tmax", label = "Maximum", color = "red") %>%
dySeries("tmin", label = "Minimum", color = "blue") %>%
dyOptions(stackedGraph = T)
zz %>%
select(tmax, tmin) %>%
xts(., order.by = zz$date) %>%
dygraph(.) %>%
dySeries("tmax", label = "Maximum", color = "red") %>%
dySeries("tmin", label = "Minimum", color = "blue") %>%
dyOptions(stackedGraph = T) %>%
dyRangeSelector()
zz %>%
select(tmax, tmin) %>%
xts(., order.by = zz$date) %>%
dygraph(.) %>%
dySeries("tmax", label = "Maximum", color = "red") %>%
dySeries("tmin", label = "Minimum", color = "blue") %>%
dyRangeSelector()
zz =  SXtemp %>%
filter(city == "datong",
county == "datong",
date >= as.Date("2013-01-01"),
date <= as.Date("2017-11-28")) %>%
arrange(date)
zz %>%
select(tmax, tmin) %>%
xts(., order.by = zz$date) %>%
dygraph(.) %>%
dySeries("tmax", label = "Maximum", color = "red") %>%
dySeries("tmin", label = "Minimum", color = "blue") %>%
dyRangeSelector()
zz %>%
select(tmax, tmin) %>%
xts(., order.by = zz$date) %>%
dygraph() %>%
dySeries("tmax", label = "Maximum", color = "red") %>%
dySeries("tmin", label = "Minimum", color = "blue") %>%
dyRangeSelector()
zz %>%
select(tmax, tmin) %>%
xts(., order.by = zz$date) %>%
dygraph(main = "Temperature plots") %>%
dySeries("tmax", label = "Maximum", color = "red") %>%
dySeries("tmin", label = "Minimum", color = "blue") %>%
dyRangeSelector()
zz %>%
select(tmax, tmin) %>%
xts(., order.by = zz$date) %>%
dygraph(main = "Temperature plots", y = "Temperatures") %>%
dySeries("tmax", label = "Maximum", color = "red") %>%
dySeries("tmin", label = "Minimum", color = "blue") %>%
dyOptions(stepPlot = T)
zz %>%
select(tmax, tmin) %>%
xts(., order.by = zz$date) %>%
dygraph(main = "Temperature plots", y = "Temperatures") %>%
dySeries("tmax", label = "Maximum", color = "red") %>%
dySeries("tmin", label = "Minimum", color = "blue") %>%
dyOptions(stepPlot = F) %>%
dyRangeSelector()
zz %>%
select(tmax, tmin) %>%
xts(., order.by = zz$date) %>%
dygraph(main = "Temperature plots", y = "Temperatures") %>%
dySeries("tmax", label = "Maximum", color = "red") %>%
dySeries("tmin", label = "Minimum", color = "blue") %>%
dyOptions(fillGraph = t) %>%
dyRangeSelector()
zz %>%
select(tmax, tmin) %>%
xts(., order.by = zz$date) %>%
dygraph(main = "Temperature plots", y = "Temperatures") %>%
dySeries("tmax", label = "Maximum", color = "red") %>%
dySeries("tmin", label = "Minimum", color = "blue") %>%
dyOptions(fillGraph = T) %>%
dyRangeSelector()
runApp()
runApp()
Sys.setlocale("LC_CTYPE", "chinese")
load("I1317.Rdata")
load("weather.Rdata")
require(tidyverse)
SXtemp = weather %>%
as_tibble() %>%
rename(date = ymd,
tmax = bWendu,
tmin = yWendu) %>%
mutate(date = lubridate::ymd(date),
tmax = as.numeric(gsub("([0-9]+).*$", "\\1", tmax)),
tmin = as.numeric(gsub("([0-9]+).*$", "\\1", tmin)),
tmed = mean(tmax + tmin),
tvarh = tmax - tmin)
library('pinyin')
mypy = pydic(method = 'toneless')
# a function to run `py()` on several vectors
conv_py = function(data, var_name){
for(i in var_name){
data[[i]] = map(data[[i]], function(x){py(x, dic = mypy)}) %>%
gsub("_", "", .) %>%
unlist()
}
return(data)
}
SXtemp = conv_py(SXtemp, c("city", "county"))
save(SXtemp, file = "SXtemp.Rdata")
runApp()
SXtemp = weather %>%
as_tibble() %>%
rename(date = ymd,
tmax = bWendu,
tmin = yWendu) %>%
mutate(date = lubridate::ymd(date),
tmax = as.numeric(gsub("([0-9]+).*$", "\\1", tmax)),
tmin = as.numeric(gsub("([0-9]+).*$", "\\1", tmin)),
tmed = mean(tmax, tmin),
tvarh = tmax - tmin)
SXtemp = weather %>%
as_tibble() %>%
rename(date = ymd,
tmax = bWendu,
tmin = yWendu) %>%
mutate(date = lubridate::ymd(date),
tmax = as.numeric(gsub("([0-9]+).*$", "\\1", tmax)),
tmin = as.numeric(gsub("([0-9]+).*$", "\\1", tmin)),
tmed = mean(tmax, tmin, na.rm = T),
tvarh = tmax - tmin)
SXtemp = weather %>%
as_tibble() %>%
rename(date = ymd,
tmax = bWendu,
tmin = yWendu) %>%
mutate(date = lubridate::ymd(date),
tmax = as.numeric(gsub("([0-9]+).*$", "\\1", tmax)),
tmin = as.numeric(gsub("([0-9]+).*$", "\\1", tmin)),
tmed = (tmax + tmin)/2,
tvarh = tmax - tmin)
SXtemp = conv_py(SXtemp, c("city", "county"))
save(SXtemp, file = "SXtemp.Rdata")
runApp()
?celsius.to.fahrenheit
install.packages("weathermetrics")
SXtemp = weather %>%
as_tibble() %>%
rename(date = ymd,
tmax = bWendu,
tmin = yWendu) %>%
mutate(date = lubridate::ymd(date),
tmax = as.numeric(gsub("([0-9]+).*$", "\\1", tmax)),
tmin = as.numeric(gsub("([0-9]+).*$", "\\1", tmin)),
tmed = (tmax + tmin)/2) %>%
mutate(tmax = weathermetrics::celsius.to.fahrenheit(tmax),
tmed = weathermetrics::celsius.to.fahrenheit(tmed),
tmin = weathermetrics::celsius.to.fahrenheit(tmin),
tvarh = tmax - tmin)
SXtemp = conv_py(SXtemp, c("city", "county"))
save(SXtemp, file = "SXtemp.Rdata")
runApp()
?tabItem
runApp()
zz =  SXtemp %>%
filter(city == "datong",
county == "datong",
date >= as.Date("2013-01-01"),
date <= as.Date("2017-11-28")) %>%
arrange(date)
z
zz
lag(zz$tmed)
lag(zz$tmed, default = zz$tmed[1])
zz %>% mutate(
diff1 = abs(tmed - lag(tmed, n =1, default = tmed[1]))
)
?cumsum
cumsum(1:10)
cummin(c(3:1, 2:0, 4:2))
zz %>% mutate(
diff1 = abs(tmed - lag(tmed, n =1, default = tmed[1]))
varh = rollsum(diff1, 7, fill = "0")
)
zz %>% mutate(
diff1 = abs(tmed - lag(tmed, n =1, default = tmed[1]))
varh = roll_sum(diff1, 7, fill = "0")
)
zz %>% mutate(
diff1 = abs(tmed - lag(tmed, n =1, default = tmed[1]))
varh = roll_sum(diff1, 7, fill = 0)
)
zz %>% mutate(
diff1 = abs(tmed - lag(tmed, n =1, default = tmed[1])),
varh = roll_sum(diff1, 7, fill = 0)
)
zz %>% mutate(
diff1 = abs(tmed - lag(tmed, n =1, default = tmed[1])),
varh = RcppRoll::roll_sum(diff1, 7, fill = 0)
)
install.packages("RcppRoll")
zz %>% mutate(
diff1 = abs(tmed - lag(tmed, n =1, default = tmed[1])),
varh = RcppRoll::roll_sum(diff1, 7, fill = 0)
)
zz %>% mutate(
diff1 = abs(tmed - lag(tmed, n =1, default = tmed[1])),
varh = RcppRoll::roll_sum(diff1, width = 7, min_obs=1, fill = 0)
)
?RcppRoll::roll_sum
zz %>% mutate(
diff1 = abs(tmed - lag(tmed, n =1, default = tmed[1])),
tvarh = RcppRoll::roll_sum(diff1, width = 7, min_obs=1, fill = 0)
)
zz %>% mutate(
diff1 = abs(tmed - lag(tmed, n =1, default = tmed[1])),
tvarh = RcppRoll::roll_sum(diff1, n = 7, fill = 0)
)
zz %>% mutate(
diff1 = abs(tmed - lag(tmed, n =1, default = tmed[1])),
tvarh = RcppRoll::roll_sum(diff1, n = 7, fill = 0)
)
zz %>% mutate(
diff1 = abs(tmed - lag(tmed, n =1, default = tmed[1])),
tvarh = RcppRoll::roll_sum(diff1, n = 7, fill = 0)
) %>% print(50)
zz %>% mutate(
diff1 = abs(tmed - lag(tmed, n =1, default = tmed[1])),
tvarh = RcppRoll::roll_sum(diff1, n = 7, fill = 0)
) %>% print(n = 50)
SXtemp = weather %>%
as_tibble() %>%
rename(date = ymd,
tmax = bWendu,
tmin = yWendu) %>%
mutate(date = lubridate::ymd(date),
tmax = as.numeric(gsub("([0-9]+).*$", "\\1", tmax)),
tmin = as.numeric(gsub("([0-9]+).*$", "\\1", tmin)),
tmed = (tmax + tmin)/2) %>%
mutate(tmax = weathermetrics::celsius.to.fahrenheit(tmax),
tmed = weathermetrics::celsius.to.fahrenheit(tmed),
tmin = weathermetrics::celsius.to.fahrenheit(tmin),
tvarv = tmax - tmin,
diff1 = abs(tmed - lag(tmed, n =1, default = tmed[1])),
tvarh = RcppRoll::roll_sum(diff1, n = 7, fill = 0))
SXtemp = conv_py(SXtemp, c("city", "county"))
save(SXtemp, file = "SXtemp.Rdata")
runApp()
packageVersion("shiny")
runApp()
runApp()
runApp()
runApp()
runApp()
names(mtcars)
select(mtcars, !!c("mpg", "cyl"))
runApp()
runApp()
runApp()
runApp()
runApp()
devtools::install_github("rstudio/leaflet")
geojsonio::geojson_read("CNjsonMAP\map\json\province\Shanxi.json")
geojsonio::geojson_read("./CNjsonMAP/map/json/province/Shanxi.json")
install.packages("geojsonio")
sx = geojsonio::geojson_read("Shanxi-1.json")
sx = geojsonio::geojson_read("shanxi-1.geojson")
class(sx)
names(sx)
leaflet::leaflet(sx)
leaflet::leaflet(sx)
sx = geojsonio::geojson_read("shanxi-2.geojson")
class(sx)
names(sx)
leaflet::leaflet(sx)
devtools::install_github("rstudio/r2d3")
r2d3::r2d3(data=c(0.3, 0.6, 0.8, 0.95, 0.40, 0.20), script = "d3plot.js")
install.packages("r2d3")
r2d3::r2d3(data=c(0.3, 0.6, 0.8, 0.95, 0.40, 0.20), script = "d3plot.js")
load("SXtemp.Rdata")
manualdata =  SXtemp %>%
filter(city == "datong",
county == "datong",
date >= as.Date("2013-01-01"),
date <= as.Date("2017-11-28")) %>%
arrange(date)
require(tidyverse)
load("SXtemp.Rdata")
manualdata =  SXtemp %>%
filter(city == "datong",
county == "datong",
date >= as.Date("2013-01-01"),
date <= as.Date("2017-11-28")) %>%
arrange(date)
head(manualdata)
save(manual_data, file = "manual_data.Rdata")
manual_data =  SXtemp %>%
filter(city == "datong",
county == "datong",
date >= as.Date("2013-01-01"),
date <= as.Date("2017-11-28")) %>%
arrange(date)
save(manual_data, file = "manual_data.Rdata")
names(manual_data)
SXtemp
require(tidyverse)
load("SXtemp.Rdata")
manual_data =  SXtemp %>%
filter(city == "datong",
county == "datong",
date >= as.Date("2013-01-01"),
date <= as.Date("2017-11-28")) %>%
arrange(date) %>%
select(date, tmax, tmed, tmin, tvarv, tvarh)
save(manual_data, file = "manual_data.Rdata")
manual_data %>%
select(tmax, tmed, tmin) %>%
xts(., order.by = manual_data$date) %>%
dygraph(main = "Temperature trend in Datong County, Datong City, Shanxi China 2013 - 2017",
y = "Temperature in Fahrenheits") %>%
dyAxis("x", drawGrid = FALSE) %>%
dyOptions(axisLineColor = "navy",
gridLineColor = "lightblue") %>%
dyLegend(width = 400)
require(tidyverse)
require(xts)
load("manual_data.Rdata")
manual_data %>%
select(tmax, tmed, tmin) %>%
xts(., order.by = manual_data$date) %>%
dygraph(main = "Temperature trend in Datong County, Datong City, Shanxi China 2013 - 2017",
y = "Temperature in Fahrenheits") %>%
dyAxis("x", drawGrid = FALSE) %>%
dyOptions(axisLineColor = "navy",
gridLineColor = "lightblue") %>%
dyLegend(width = 400)
require(dygraphs)
manual_data %>%
select(tmax, tmed, tmin) %>%
xts(., order.by = manual_data$date) %>%
dygraph(main = "Temperature trend in Datong County, Datong City, Shanxi China 2013 - 2017",
y = "Temperature in Fahrenheits") %>%
dyAxis("x", drawGrid = FALSE) %>%
dyOptions(axisLineColor = "navy",
gridLineColor = "lightblue") %>%
dyLegend(width = 400)
manual_data %>%
select(tvarv, tvarh) %>%
xts(., order.by = manual_data$date) %>%
dygraph(main = "Temperature variation in Datong County,
Datong City, Shanxi China 2013 - 2017",
y = "Temperature in Fahrenheits") %>%
dySeries("tvarv", label = "Vertical variation", color = "orange") %>%
dySeries("tvarh", label = "Horizontal variation", color = "green") %>%
dyOptions(axisLineColor = "navy",
gridLineColor = "lightblue") %>%
dyAxis("x", drawGrid = FALSE) %>%
dyLegend(width = 400) %>%
dyRangeSelector()
manual_data %>%
select(tmax, tmed, tmin) %>%
xts(., order.by = manual_data$date) %>%
dygraph(main = "Temperature trend in Datong County,
Datong City, Shanxi China 2013 - 2017",
y = "Temperature in Fahrenheits") %>%
dyAxis("x", drawGrid = FALSE) %>%
dyOptions() %>%
dyLegend(width = 400)
manual_data %>%
select(tvarv, tvarh) %>%
xts(., order.by = manual_data$date) %>%
dygraph(main = "Temperature variation in Datong County,
Datong City, Shanxi China 2013 - 2017",
y = "Temperature in Fahrenheits") %>%
dySeries("tvarv", label = "Vertical variation", color = "orange") %>%
dySeries("tvarh", label = "Horizontal variation", color = "green") %>%
dyOptions() %>%
dyAxis("x", drawGrid = FALSE) %>%
dyLegend(width = 400) %>%
dyRangeSelector()
count(weather, county)
install.packages("Xaringan")
install.packages("xaringan")
shiny::runApp()
runApp()
length(cities)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
